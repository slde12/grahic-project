<!DOCTYPE html>
<html>
<head>
    <title>Graph Search Algorithm</title>
    <!-- <script src="https://threejs.org/build/three.js"></script> -->
    <script src="three.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script src="https://threejs.org/examples/js/libs/dat.gui.min.js"></script>
    <script src="buckets.min.js"></script>
    <script src="bfs.js"></script>
    <script src="helper.js"></script>
    <script>
        function mainFunction(){
            let renderer = new THREE.WebGLRenderer( {antialis: true} );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setPixelRatio( window.deceivePixelRatio );

            renderer.setClearColor( 0x888888, 1 );
            document.body.appendChild( renderer.domElement );

            let scene = new THREE.Scene();
            let aspect = window.innerWidth/window.innerHeight;
            let camera = new THREE.PerspectiveCamera( 100, aspect, 0.1, 1000 );

            let numOfNodes = 10;

            let render = function () {
                renderer.render( scene, camera );
            };


            camera.position.z = 50;
            scene.add(camera);
            scene.add(new THREE.AxesHelper(50));
            // scene.add( new THREE.GridHelper( 100, 25 , 0x0F0F0F, 0xFFFFFF));

            // let originalGeometry = new THREE.SphereGeometry( 1, 100, 100 );
            // let original = new THREE.Mesh( originalGeometry, new THREE.MeshPhongMaterial( {color: 0xffffff} ) );
            // scene.add( original );

            // randomly generate nodes
            // nodes: ref of node obj
            let nodes = [];
            let positions = [];
            randomGenerateNodes(numOfNodes, nodes, positions);
            
            // randomly generate edges
            let edges = randomGenerateEdges(numOfNodes);
            //let edges = randomGenerate(nodes.length);

            // console.log("check1");
            // add nodes to scene
            addNodes(nodes, scene);

            // build add edge lines to scene
            addLines(edges, positions, scene);

            let ambientLight = new THREE.AmbientLight(0x888888, 0.25);
            scene.add(ambientLight);
        
            let pointLight = new THREE.PointLight( 0xffffff, 1 );
            pointLight.position.set( 100, 100, 100 );
            scene.add(pointLight);

            var cx = 0, cy = 0, cz = 0;
            for( var i = 0; i < numOfNodes; i++ ){
                cx += positions[i].x;
                cy += positions[i].y;
                cz += positions[i].z;
            }


            let cameraControls = new THREE.OrbitControls( camera, renderer.doElement );
            cameraControls.addEventListener( "change", render, false );

            render();

            let graph = new Graph(numOfNodes);

            console.log(edges);
            graph.build(edges)

            bfsSearch(0, graph);

            let customNode = {
                x: 0,
                y: 0,
                z: 0,
                color: 0x000000,
                add: function () {
                    var customNodeGeometry = new THREE.SphereGeometry( 1, 100, 100 );
                    var customNodeMaterial = new THREE.MeshPhongMaterial( {color: this.color} );
                    var node = new THREE.Mesh( customNodeGeometry, customNodeMaterial );
                    node.position.set( this.x, this.y, this.z );
                    nodes.push( node );
                    positions.push( new THREE.Vector3( this.x, this.y, this.z ) );
                    scene.add( node );
                    render();
                }
            }

            let gui = new dat.GUI();
            let guiNode = gui.addFolder( 'Node' );
            guiNode.addColor( customNode, 'color' );
            guiNode.add( customNode, 'x' , -30, 30 ).name( 'X' );
            // guiNode.add( customNode, 'y' , -30, 30 ).name( 'Y' );
            guiNode.add( customNode, 'z' , -30, 30 ).name( 'Z' );
            guiNode.add( customNode, 'add').name( 'Add' );

        }
    </script>
</head>
<body onload="mainFunction();">
<h1>environment set up</h1>
</body>
</html>